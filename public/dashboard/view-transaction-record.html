<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction Management System</title>
    <style>
        /* Basic Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            background-color: #f4f6f9;
            color: #333;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        /* Form Styles */
        .transaction-form {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
        }
        
        .form-title {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .form-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Table Styles */
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
        
        .action-cell {
            white-space: nowrap;
            text-align: right;
        }
        
        .action-cell button {
            margin-left: 5px;
        }
        
        /* Alerts */
        .alert {
            padding: 12px 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            border-left: 4px solid;
        }
        
        .alert-success {
            background-color: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }
        
        .hidden {
            display: none;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .action-cell {
                display: flex;
                flex-direction: column;
                gap: 5px;
            }
            
            .action-cell button {
                margin-left: 0;
                margin-top: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Transaction Management System</h1>
        
        <!-- Alert Messages -->
        <div id="alert" class="alert hidden"></div>
        
        <!-- Transaction Form -->
        <div id="transaction-form-container" class="transaction-form hidden">
            <h2 class="form-title">Add New Transaction</h2>
            <form id="transaction-form">
                <input type="hidden" id="edit-id" value="">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="date">Date:</label>
                        <input type="date" id="date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="type">Type:</label>
                        <select id="type" required>
                            <option value="">Select Type</option>
                            <option value="Income">Income</option>
                            <option value="Expense">Expense</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="description">Description:</label>
                    <input type="text" id="description" placeholder="Enter transaction description" required>
                </div>
                
                <div class="form-group">
                    <label for="amount">Amount:</label>
                    <input type="number" id="amount" step="0.01" min="0.01" placeholder="Enter amount" required>
                </div>
                
                <div class="form-buttons">
                    <button type="button" id="cancel-btn" class="btn btn-danger">Cancel</button>
                    <button type="submit" id="save-btn" class="btn btn-primary">Save Transaction</button>
                </div>
            </form>
        </div>
        
        <!-- Add Transaction Button -->
        <div id="add-transaction-container">
            <button id="add-transaction-btn" class="btn btn-success">Add New Transaction</button>
        </div>
        
        <!-- Transactions Table -->
        <div class="table-container">
            <table id="transactions-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Date</th>
                        <th>Description</th>
                        <th>Amount</th>
                        <th>Type</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Transaction data will be inserted here dynamically -->
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        // DOM Elements
        const transactionFormContainer = document.getElementById('transaction-form-container');
        const addTransactionContainer = document.getElementById('add-transaction-container');
        const addTransactionBtn = document.getElementById('add-transaction-btn');
        const transactionForm = document.getElementById('transaction-form');
        const cancelBtn = document.getElementById('cancel-btn');
        const saveBtn = document.getElementById('save-btn');
        const alertEl = document.getElementById('alert');
        
        // Form fields
        const editIdInput = document.getElementById('edit-id');
        const dateInput = document.getElementById('date');
        const descriptionInput = document.getElementById('description');
        const amountInput = document.getElementById('amount');
        const typeInput = document.getElementById('type');
        
        // Configuration
        const apiUrl = 'http://localhost:3000/transactions';
        const currentRole = 'accountant'; // Fixed role as accountant
        let transactions = [];
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            // Set default date to today
            dateInput.valueAsDate = new Date();
            
            // Load transactions
            fetchTransactions();
            
            // Event listeners
            addTransactionBtn.addEventListener('click', showAddTransactionForm);
            cancelBtn.addEventListener('click', hideTransactionForm);
            transactionForm.addEventListener('submit', handleFormSubmit);
        });
        
        // Fetch transactions from the server
        async function fetchTransactions() {
            try {
                const response = await fetch(apiUrl, {
                    headers: { 'Role': currentRole }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch transactions');
                }
                
                transactions = await response.json();
                displayTransactions(transactions);
            } catch (error) {
                showAlert(error.message, 'danger');
            }
        }
        
        // Display transactions in the table
        function displayTransactions(transactions) {
            const tableBody = document.querySelector('#transactions-table tbody');
            tableBody.innerHTML = '';
            
            if (transactions.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" style="text-align: center">No transactions found</td>`;
                tableBody.appendChild(row);
                return;
            }
            
            transactions.forEach(transaction => {
                const row = document.createElement('tr');
                
                // Format date (assuming it's in ISO format from the server)
                const date = new Date(transaction.date);
                const formattedDate = date.toLocaleDateString();
                
                // Format amount to 2 decimal places
                const formattedAmount = parseFloat(transaction.amount).toFixed(2);
                
                row.innerHTML = `
                    <td>${transaction.transaction_id}</td>
                    <td>${formattedDate}</td>
                    <td>${transaction.description}</td>
                    <td>${formattedAmount}</td>
                    <td>${transaction.type}</td>
                    <td class="action-cell">
                        <button class="btn btn-primary edit-btn" data-id="${transaction.transaction_id}">Edit</button>
                        <button class="btn btn-danger delete-btn" data-id="${transaction.transaction_id}">Delete</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', () => handleEditClick(btn.getAttribute('data-id')));
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', () => handleDeleteClick(btn.getAttribute('data-id')));
            });
        }
        
        // Show add transaction form
        function showAddTransactionForm() {
            // Reset form
            transactionForm.reset();
            editIdInput.value = '';
            dateInput.valueAsDate = new Date();
            
            // Update title
            document.querySelector('.form-title').textContent = 'Add New Transaction';
            saveBtn.textContent = 'Save Transaction';
            
            // Show form
            transactionFormContainer.classList.remove('hidden');
            addTransactionContainer.classList.add('hidden');
        }
        
        // Handle edit button click
        function handleEditClick(id) {
            const transaction = transactions.find(t => t.transaction_id == id);
            if (!transaction) return;
            
            // Fill form with transaction data
            editIdInput.value = transaction.transaction_id;
            dateInput.value = new Date(transaction.date).toISOString().split('T')[0];
            descriptionInput.value = transaction.description;
            amountInput.value = transaction.amount;
            typeInput.value = transaction.type;
            
            // Update form title and button
            document.querySelector('.form-title').textContent = 'Edit Transaction';
            saveBtn.textContent = 'Update Transaction';
            
            // Show form
            transactionFormContainer.classList.remove('hidden');
            addTransactionContainer.classList.add('hidden');
        }
        
        // Handle delete button click
        function handleDeleteClick(id) {
            if (confirm('Are you sure you want to delete this transaction? This action cannot be undone.')) {
                deleteTransaction(id);
            }
        }
        
        // Hide transaction form
        function hideTransactionForm() {
            transactionFormContainer.classList.add('hidden');
            addTransactionContainer.classList.remove('hidden');
        }
        
        // Handle form submit (add or update)
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const transactionId = editIdInput.value;
            const isEditing = !!transactionId;
            
            const transactionData = {
                date: dateInput.value,
                description: descriptionInput.value,
                amount: amountInput.value,
                type: typeInput.value
            };
            
            try {
                let response;
                
                if (isEditing) {
                    // Update existing transaction
                    response = await fetch(`${apiUrl}/${transactionId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Role': currentRole
                        },
                        body: JSON.stringify(transactionData)
                    });
                } else {
                    // Add new transaction
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Role': currentRole
                        },
                        body: JSON.stringify(transactionData)
                    });
                }
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(errorText || `Failed to ${isEditing ? 'update' : 'add'} transaction`);
                }
                
                // Show success message
                showAlert(`Transaction ${isEditing ? 'updated' : 'added'} successfully`, 'success');
                
                // Reset and hide form
                transactionForm.reset();
                hideTransactionForm();
                
                // Refresh transactions
                fetchTransactions();
                
            } catch (error) {
                showAlert(error.message, 'danger');
            }
        }
        
        // Delete transaction
        async function deleteTransaction(id) {
            try {
                const response = await fetch(`${apiUrl}/${id}`, {
                    method: 'DELETE',
                    headers: { 'Role': currentRole }
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(errorText || 'Failed to delete transaction');
                }
                
                // Show success message
                showAlert('Transaction deleted successfully', 'success');
                
                // Refresh transactions
                fetchTransactions();
                
            } catch (error) {
                showAlert(error.message, 'danger');
            }
        }
        
        // Show alert message
        function showAlert(message, type) {
            alertEl.textContent = message;
            alertEl.className = `alert alert-${type}`;
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                alertEl.classList.add('hidden');
            }, 3000);
        }
    </script>
</body>
</html>